/**
 * マークダウン記法をプレーンテキストに変換する。
 *
 * LLM の応答に含まれるマークダウン記法を LINE メッセージ向けに除去する。
 * instruction でもマークダウン禁止を指示しているが、漏れた場合のフォールバック。
 */
export function stripMarkdown(text: string): string {
  return (
    text
      // 見出し（# ## ### 等）→ 除去
      .replace(/^#{1,6}\s+/gm, '')
      // 太字 **text** または __text__ → text
      .replace(/\*\*(.+?)\*\*/g, '$1')
      .replace(/__(.+?)__/g, '$1')
      // 斜体 *text* または _text_ → text（単語境界を考慮）
      .replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '$1')
      .replace(/(?<!_)_(?!_)(.+?)(?<!_)_(?!_)/g, '$1')
      // 取り消し線 ~~text~~ → text
      .replace(/~~(.+?)~~/g, '$1')
      // インラインコード `code` → code
      .replace(/`(.+?)`/g, '$1')
      // マークダウンリスト（- や * で始まる行）→ ・に変換
      .replace(/^[\s]*[-*]\s+/gm, '・')
      // 番号付きリスト（1. 2. 等）→ そのまま（自然な表記）
  );
}
