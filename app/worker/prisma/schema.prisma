generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserSession {
  userId       String        @id @map("user_id")
  sessionId    String        @map("session_id")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  goals        Goal[]
  exerciseLogs ExerciseLog[]
  dietLogs     DietLog[]

  @@map("user_sessions")
}

model Goal {
  id        String      @id @default(uuid())
  userId    String      @map("user_id")
  details   String
  habits    String
  createdAt DateTime    @default(now()) @map("created_at")
  user      UserSession @relation(fields: [userId], references: [userId])

  @@map("goals")
}

model ExerciseLog {
  id            String      @id @default(uuid())
  userId        String      @map("user_id")
  exerciseName  String      @map("exercise_name")
  sets          Json
  category      String?
  muscleGroup   String?     @map("muscle_group")
  totalSets     Int         @map("total_sets")
  totalReps     Int?        @map("total_reps")
  totalDuration Int?        @map("total_duration")
  totalDistance Float?      @map("total_distance")
  totalVolume   Float?      @map("total_volume")
  note          String?
  recordedAt    DateTime    @default(now()) @map("recorded_at")
  createdAt     DateTime    @default(now()) @map("created_at")
  user          UserSession @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("exercise_logs")
  @@index([userId, recordedAt(sort: Desc)])
  @@index([userId, exerciseName, recordedAt(sort: Desc)])
}

model DietLog {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")

  // 食事の基本情報
  name        String
  mealType    String   @map("meal_type")  // "breakfast", "lunch", "dinner", "snack"

  // 必須栄養素
  calories      Float    // kcal
  proteins      Float    // g
  fats          Float    // g
  carbohydrates Float    // g

  // 追加栄養素（オプション）
  sodium      Float?   // mg
  fiber       Float?   // g
  sugar       Float?   // g

  // AI推定関連
  estimationSource  String   @map("estimation_source")  // "text", "image"
  isUserCorrected   Boolean  @default(false) @map("is_user_corrected")
  imageUrl          String?  @map("image_url")

  // メタデータ
  note        String?
  recordedAt  DateTime @map("recorded_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // リレーション
  user        UserSession @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("diet_logs")
  @@index([userId, recordedAt(sort: Desc)])
  @@index([userId, mealType, recordedAt(sort: Desc)])
}
