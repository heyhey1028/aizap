generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserSession {
  userId       String        @id @map("user_id")
  sessionId    String        @map("session_id")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  goals        Goal[]
  exerciseLogs ExerciseLog[]
<<<<<<< HEAD
  habits       Habit[]
=======
>>>>>>> 900f334c765e7f6ca858b3fa370587bab0702158

  @@map("user_sessions")
}

model Goal {
  id           String      @id @default(uuid())
  userId       String      @map("user_id")
  details      String
  habits       String
  createdAt    DateTime    @default(now()) @map("created_at")
  user         UserSession @relation(fields: [userId], references: [userId])
  habitDetails Habit[]

  @@map("goals")
}

model ExerciseLog {
  id            String      @id @default(uuid())
  userId        String      @map("user_id")
  exerciseName  String      @map("exercise_name")
  sets          Json
  category      String?
  muscleGroup   String?     @map("muscle_group")
  totalSets     Int         @map("total_sets")
  totalReps     Int?        @map("total_reps")
  totalDuration Int?        @map("total_duration")
  totalDistance Float?      @map("total_distance")
  totalVolume   Float?      @map("total_volume")
  note          String?
  recordedAt    DateTime    @default(now()) @map("recorded_at")
  createdAt     DateTime    @default(now()) @map("created_at")
  user          UserSession @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("exercise_logs")
  @@index([userId, recordedAt(sort: Desc)])
  @@index([userId, exerciseName, recordedAt(sort: Desc)])
}

model Habit {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  goalId      String?  @map("goal_id")

  // 習慣の基本情報
  habitType   String   @map("habit_type")
  title       String
  description String?

  // ルーティンのグルーピング
  routineId       String? @map("routine_id")
  routineName     String? @map("routine_name")
  orderInRoutine  Int?    @map("order_in_routine")

  // 運動習慣の詳細（habitType="exercise"の場合）
  exerciseName    String? @map("exercise_name")
  category        String?
  muscleGroup     String? @map("muscle_group")
  targetSets      Int?    @map("target_sets")
  targetReps      Int?    @map("target_reps")
  targetDuration  Int?    @map("target_duration")
  targetDistance  Float?  @map("target_distance")
  targetWeight    Float?  @map("target_weight")

  // 食事習慣の詳細（habitType="meal"の場合）※Phase 2で本格実装
  mealType        String? @map("meal_type")
  targetCalories  Int?    @map("target_calories")
  targetProteinG  Float?  @map("target_protein_g")
  targetCarbsG    Float?  @map("target_carbs_g")
  targetFatG      Float?  @map("target_fat_g")
  mealGuidelines  String? @map("meal_guidelines")

  // スケジュール設定
  frequency  String   @map("frequency")
  daysOfWeek Json?    @map("days_of_week")
  timeOfDay  String?  @map("time_of_day")

  // ステータスと期間
  isActive  Boolean   @default(true) @map("is_active")
  startDate DateTime  @default(now()) @map("start_date")
  endDate   DateTime? @map("end_date")

  // メタデータ
  notes     String?
  priority  Int?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // リレーション
  user UserSession @relation(fields: [userId], references: [userId], onDelete: Cascade)
  goal Goal?       @relation(fields: [goalId], references: [id], onDelete: SetNull)

  @@map("habits")
  @@index([userId, habitType, isActive])
  @@index([userId, routineId])
  @@index([userId, startDate])
  @@index([goalId])
}
